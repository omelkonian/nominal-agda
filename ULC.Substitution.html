<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ULC.Substitution</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="52" class="Keyword">open</a> <a id="57" class="Keyword">import</a> <a id="64" href="Prelude.DecLists.html" class="Module">Prelude.DecLists</a>
<a id="81" class="Keyword">open</a> <a id="86" class="Keyword">import</a> <a id="93" href="Prelude.Measurable.html" class="Module">Prelude.Measurable</a>
<a id="112" class="Keyword">open</a> <a id="117" class="Keyword">import</a> <a id="124" href="Prelude.InfEnumerable.html" class="Module">Prelude.InfEnumerable</a>
<a id="146" class="Keyword">open</a> <a id="151" class="Keyword">import</a> <a id="158" href="Prelude.Setoid.html" class="Module">Prelude.Setoid</a>

<a id="174" class="Comment">-- ** Substitution.</a>
<a id="194" class="Keyword">module</a> <a id="201" href="ULC.Substitution.html" class="Module">ULC.Substitution</a> <a id="218" class="Symbol">(</a><a id="219" href="ULC.Substitution.html#219" class="Bound">Atom</a> <a id="224" class="Symbol">:</a> <a id="226" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="229" class="Symbol">)</a> <a id="231" class="Symbol">⦃</a> <a id="233" href="ULC.Substitution.html#233" class="Bound">_</a> <a id="235" class="Symbol">:</a> <a id="237" href="Prelude.DecEq.Core.html#97" class="Record">DecEq</a> <a id="243" href="ULC.Substitution.html#219" class="Bound">Atom</a> <a id="248" class="Symbol">⦄</a> <a id="250" class="Symbol">⦃</a> <a id="252" href="ULC.Substitution.html#252" class="Bound">_</a> <a id="254" class="Symbol">:</a> <a id="256" href="Prelude.InfEnumerable.html#522" class="Record">Enumerable∞</a> <a id="268" href="ULC.Substitution.html#219" class="Bound">Atom</a> <a id="273" class="Symbol">⦄</a> <a id="275" class="Keyword">where</a>

<a id="282" class="Keyword">open</a> <a id="287" class="Keyword">import</a> <a id="294" href="ULC.Base.html" class="Module">ULC.Base</a>    <a id="306" href="ULC.Substitution.html#219" class="Bound">Atom</a>
<a id="311" class="Keyword">open</a> <a id="316" class="Keyword">import</a> <a id="323" href="ULC.Measure.html" class="Module">ULC.Measure</a> <a id="335" href="ULC.Substitution.html#219" class="Bound">Atom</a>
<a id="340" class="Keyword">open</a> <a id="345" class="Keyword">import</a> <a id="352" href="ULC.Alpha.html" class="Module">ULC.Alpha</a>   <a id="364" href="ULC.Substitution.html#219" class="Bound">Atom</a>
<a id="369" class="Keyword">open</a> <a id="374" class="Keyword">import</a> <a id="381" href="Nominal.html" class="Module">Nominal</a>     <a id="393" href="ULC.Substitution.html#219" class="Bound">Atom</a>

<a id="399" class="Comment">-- specialized version of `mapAbs` for Term</a>
<a id="443" class="Comment">-- mapAbs-Term : (x&#39; : Abs Term) → (∀ (t : Term) → t ≺ᵐ x&#39; → Term) → Abs Term</a>
<a id="521" class="Comment">-- mapAbs-Term x&#39; f =</a>
<a id="543" class="Comment">--   let a , _ = fresh (supp x&#39; ++ supp?? f)</a>
<a id="588" class="Comment">--   in abs a (f (conc x&#39; a) (conc≺ x&#39; a))</a>

<a id="632" class="Comment">-- capture-avoiding application</a>
<a id="664" class="Comment">-- conc† : Abs Term → Atom → Term</a>
<a id="698" class="Comment">-- conc† f@(abs x t) y =</a>
<a id="723" class="Comment">--   let z , _ = fresh (y ∷ supp f)</a>
<a id="759" class="Comment">--   in conc (⦅ x ↔ z ⦆ f) y</a>

<a id="_[_/_]"></a><a id="789" href="ULC.Substitution.html#789" class="Function Operator">_[_/_]</a> <a id="796" class="Symbol">:</a> <a id="798" href="ULC.Base.html#324" class="Datatype">Term</a> <a id="803" class="Symbol">→</a> <a id="805" href="ULC.Substitution.html#219" class="Bound">Atom</a> <a id="810" class="Symbol">→</a> <a id="812" href="ULC.Base.html#324" class="Datatype">Term</a> <a id="817" class="Symbol">→</a> <a id="819" href="ULC.Base.html#324" class="Datatype">Term</a>
<a id="824" href="ULC.Substitution.html#824" class="Bound">t₀</a> <a id="827" href="ULC.Substitution.html#789" class="Function Operator">[</a> <a id="829" href="ULC.Substitution.html#829" class="Bound">𝕒</a> <a id="831" href="ULC.Substitution.html#789" class="Function Operator">/</a> <a id="833" href="ULC.Substitution.html#833" class="Bound">s</a> <a id="835" href="ULC.Substitution.html#789" class="Function Operator">]</a> <a id="837" class="Symbol">=</a> <a id="839" href="Prelude.Measurable.html#1512" class="Function">≺-rec</a> <a id="845" class="Symbol">_</a> <a id="847" href="ULC.Substitution.html#865" class="Function">go</a> <a id="850" href="ULC.Substitution.html#824" class="Bound">t₀</a>
  <a id="855" class="Keyword">where</a>
    <a id="865" href="ULC.Substitution.html#865" class="Function">go</a> <a id="868" class="Symbol">:</a> <a id="870" class="Symbol">∀</a> <a id="872" href="ULC.Substitution.html#872" class="Bound">x</a> <a id="874" class="Symbol">→</a> <a id="876" class="Symbol">(∀</a> <a id="879" href="ULC.Substitution.html#879" class="Bound">y</a> <a id="881" class="Symbol">→</a> <a id="883" href="ULC.Substitution.html#879" class="Bound">y</a> <a id="885" href="Prelude.Measurable.html#1407" class="Function Operator">≺</a> <a id="887" href="ULC.Substitution.html#872" class="Bound">x</a> <a id="889" class="Symbol">→</a> <a id="891" href="ULC.Base.html#324" class="Datatype">Term</a><a id="895" class="Symbol">)</a> <a id="897" class="Symbol">→</a> <a id="899" href="ULC.Base.html#324" class="Datatype">Term</a>
    <a id="908" href="ULC.Substitution.html#865" class="Function">go</a> <a id="911" href="ULC.Substitution.html#911" class="Bound">x</a> <a id="913" href="ULC.Substitution.html#913" class="Bound">rec</a> <a id="917" class="Keyword">with</a> <a id="922" href="ULC.Substitution.html#911" class="Bound">x</a>
    <a id="928" class="Symbol">...</a> <a id="932" class="Symbol">|</a> <a id="934" href="ULC.Base.html#344" class="InductiveConstructor Operator">`</a> <a id="936" href="ULC.Substitution.html#936" class="Bound">x</a>   <a id="940" class="Symbol">=</a> <a id="942" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="945" href="ULC.Substitution.html#936" class="Bound">x</a> <a id="947" href="Prelude.DecEq.Core.html#169" class="Function Operator">==</a> <a id="950" href="ULC.Substitution.html#829" class="Bound">𝕒</a> <a id="952" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="957" href="ULC.Substitution.html#833" class="Bound">s</a> <a id="959" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="964" href="ULC.Base.html#344" class="InductiveConstructor Operator">`</a> <a id="966" href="ULC.Substitution.html#936" class="Bound">x</a>
    <a id="972" class="Symbol">...</a> <a id="976" class="Symbol">|</a> <a id="978" href="ULC.Substitution.html#978" class="Bound">l</a> <a id="980" href="ULC.Base.html#364" class="InductiveConstructor Operator">·</a> <a id="982" href="ULC.Substitution.html#982" class="Bound">m</a> <a id="984" class="Symbol">=</a> <a id="986" class="Bound">rec</a> <a id="990" href="ULC.Substitution.html#978" class="Bound">l</a> <a id="992" class="Symbol">(</a><a id="993" href="ULC.Substitution.html#978" class="Bound">l</a> <a id="995" href="ULC.Measure.html#2172" class="Function Operator">·≺ˡ</a> <a id="999" href="ULC.Substitution.html#982" class="Bound">m</a><a id="1000" class="Symbol">)</a> <a id="1002" href="ULC.Base.html#364" class="InductiveConstructor Operator">·</a> <a id="1004" class="Bound">rec</a> <a id="1008" href="ULC.Substitution.html#982" class="Bound">m</a> <a id="1010" class="Symbol">(</a><a id="1011" href="ULC.Substitution.html#978" class="Bound">l</a> <a id="1013" href="ULC.Measure.html#2317" class="Function Operator">·≺ʳ</a> <a id="1017" href="ULC.Substitution.html#982" class="Bound">m</a><a id="1018" class="Symbol">)</a>
    <a id="1024" class="Comment">-- Cannot simply use `ƛ (mapAbs go f)` here; need well-founded recursion</a>
    <a id="1101" class="Comment">-- ... | ƛ f   = ƛ mapAbs-Term f (λ t t≺ → rec t t≺)</a>
    <a id="1158" class="Symbol">...</a> <a id="1162" class="Symbol">|</a> <a id="1164" href="ULC.Base.html#381" class="InductiveConstructor Operator">ƛ</a> <a id="1166" href="ULC.Substitution.html#1166" class="Bound">f</a> <a id="1168" class="Symbol">=</a>
      <a id="1176" class="Keyword">let</a> <a id="1180" href="ULC.Substitution.html#1180" class="Bound">y</a> <a id="1182" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1184" class="Symbol">_</a> <a id="1186" class="Symbol">=</a> <a id="1188" href="Prelude.InfEnumerable.html#1418" class="Function">fresh</a> <a id="1194" class="Symbol">(</a><a id="1195" href="Prelude.DecLists.html#1445" class="Function">nub</a> <a id="1199" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1201" href="ULC.Substitution.html#829" class="Bound">𝕒</a> <a id="1203" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1205" href="Nominal.Support.html#653" class="Function">supp</a> <a id="1210" href="ULC.Substitution.html#1166" class="Bound">f</a> <a id="1212" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="1215" href="Nominal.Support.html#653" class="Function">supp</a> <a id="1220" href="ULC.Substitution.html#833" class="Bound">s</a><a id="1221" class="Symbol">)</a>
      <a id="1229" class="Keyword">in</a>  <a id="1233" href="ULC.Base.html#716" class="InductiveConstructor Operator">ƛ</a> <a id="1235" href="ULC.Substitution.html#1180" class="Bound">y</a> <a id="1237" href="ULC.Base.html#716" class="InductiveConstructor Operator">⇒</a> <a id="1239" class="Bound">rec</a> <a id="1243" class="Symbol">(</a><a id="1244" href="Nominal.Abs.Base.html#1304" class="Function">conc</a> <a id="1249" href="ULC.Substitution.html#1166" class="Bound">f</a> <a id="1251" href="ULC.Substitution.html#1180" class="Bound">y</a><a id="1252" class="Symbol">)</a> <a id="1254" class="Symbol">(</a><a id="1255" href="ULC.Measure.html#1770" class="Function">conc≺</a> <a id="1261" href="ULC.Substitution.html#1166" class="Bound">f</a> <a id="1263" href="ULC.Substitution.html#1180" class="Bound">y</a><a id="1264" class="Symbol">)</a>

<a id="1267" class="Comment">-- enforce the Barendregt convention: no shadowing, distinct bound variables</a>
<a id="1344" class="Comment">-- T0D0: fix</a>
<a id="barendregt"></a><a id="1357" href="ULC.Substitution.html#1357" class="Function">barendregt</a> <a id="1368" class="Symbol">:</a> <a id="1370" href="Algebra.Core.html#475" class="Function">Op₁</a> <a id="1374" href="ULC.Base.html#324" class="Datatype">Term</a>
<a id="1379" href="ULC.Substitution.html#1357" class="Function">barendregt</a> <a id="1390" class="Symbol">=</a> <a id="1392" class="Symbol">λ</a> <a id="1394" class="Keyword">where</a>
  <a id="1402" class="Symbol">(</a><a id="1403" href="ULC.Base.html#344" class="InductiveConstructor Operator">`</a> <a id="1405" href="ULC.Substitution.html#1405" class="Bound">x</a><a id="1406" class="Symbol">)</a>     <a id="1412" class="Symbol">→</a> <a id="1414" href="ULC.Base.html#344" class="InductiveConstructor Operator">`</a> <a id="1416" href="ULC.Substitution.html#1405" class="Bound">x</a>
  <a id="1420" class="Symbol">(</a><a id="1421" href="ULC.Substitution.html#1421" class="Bound">l</a> <a id="1423" href="ULC.Base.html#364" class="InductiveConstructor Operator">·</a> <a id="1425" href="ULC.Substitution.html#1425" class="Bound">r</a><a id="1426" class="Symbol">)</a>   <a id="1430" class="Symbol">→</a> <a id="1432" href="ULC.Substitution.html#1357" class="Function">barendregt</a> <a id="1443" href="ULC.Substitution.html#1421" class="Bound">l</a> <a id="1445" href="ULC.Base.html#364" class="InductiveConstructor Operator">·</a> <a id="1447" href="ULC.Substitution.html#1357" class="Function">barendregt</a> <a id="1458" href="ULC.Substitution.html#1425" class="Bound">r</a>
  <a id="1462" class="Symbol">(</a><a id="1463" href="ULC.Base.html#716" class="InductiveConstructor Operator">ƛ</a> <a id="1465" href="ULC.Substitution.html#1465" class="Bound">a</a> <a id="1467" href="ULC.Base.html#716" class="InductiveConstructor Operator">⇒</a> <a id="1469" href="ULC.Substitution.html#1469" class="Bound">t</a><a id="1470" class="Symbol">)</a> <a id="1472" class="Symbol">→</a> <a id="1474" href="ULC.Base.html#381" class="InductiveConstructor Operator">ƛ</a> <a id="1476" href="Nominal.Support.html#3350" class="Function">freshen</a> <a id="1484" class="Symbol">(</a><a id="1485" href="Nominal.Abs.Base.html#406" class="InductiveConstructor">abs</a> <a id="1489" href="ULC.Substitution.html#1465" class="Bound">a</a> <a id="1491" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1493" href="ULC.Substitution.html#1357" class="Function">barendregt</a> <a id="1504" href="ULC.Substitution.html#1469" class="Bound">t</a><a id="1505" class="Symbol">)</a>
</pre></body></html>