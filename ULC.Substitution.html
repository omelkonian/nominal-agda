<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ULC.Substitution</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/nominal-agda/tree/master/ULC/Substitution.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="26" class="Keyword">open</a> <a id="31" href="Prelude.Init.html#35" class="Module">SetAsType</a>
<a id="41" class="Keyword">open</a> <a id="46" class="Keyword">import</a> <a id="53" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="67" class="Keyword">open</a> <a id="72" class="Keyword">import</a> <a id="79" href="Prelude.DecLists.html" class="Module">Prelude.DecLists</a>
<a id="96" class="Keyword">open</a> <a id="101" class="Keyword">import</a> <a id="108" href="Prelude.Measurable.html" class="Module">Prelude.Measurable</a>
<a id="127" class="Keyword">open</a> <a id="132" class="Keyword">import</a> <a id="139" href="Prelude.InfEnumerable.html" class="Module">Prelude.InfEnumerable</a>
<a id="161" class="Keyword">open</a> <a id="166" class="Keyword">import</a> <a id="173" href="Prelude.Setoid.html" class="Module">Prelude.Setoid</a>

<a id="189" class="Comment">-- ** Substitution.</a>
<a id="209" class="Keyword">module</a> <a id="216" href="ULC.Substitution.html" class="Module">ULC.Substitution</a> <a id="233" class="Symbol">(</a><a id="234" href="ULC.Substitution.html#234" class="Bound">Atom</a> <a id="239" class="Symbol">:</a> <a id="241" href="Agda.Primitive.html#326" class="Primitive">Type</a><a id="245" class="Symbol">)</a> <a id="247" class="Symbol">⦃</a> <a id="249" href="ULC.Substitution.html#249" class="Bound">_</a> <a id="251" class="Symbol">:</a> <a id="253" href="Prelude.DecEq.Core.html#97" class="Record">DecEq</a> <a id="259" href="ULC.Substitution.html#234" class="Bound">Atom</a> <a id="264" class="Symbol">⦄</a> <a id="266" class="Symbol">⦃</a> <a id="268" href="ULC.Substitution.html#268" class="Bound">_</a> <a id="270" class="Symbol">:</a> <a id="272" href="Prelude.InfEnumerable.html#515" class="Record">Enumerable∞</a> <a id="284" href="ULC.Substitution.html#234" class="Bound">Atom</a> <a id="289" class="Symbol">⦄</a> <a id="291" class="Keyword">where</a>

<a id="298" class="Keyword">open</a> <a id="303" class="Keyword">import</a> <a id="310" href="ULC.Base.html" class="Module">ULC.Base</a>    <a id="322" href="ULC.Substitution.html#234" class="Bound">Atom</a>
<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="ULC.Measure.html" class="Module">ULC.Measure</a> <a id="351" href="ULC.Substitution.html#234" class="Bound">Atom</a>
<a id="356" class="Keyword">open</a> <a id="361" class="Keyword">import</a> <a id="368" href="ULC.Alpha.html" class="Module">ULC.Alpha</a>   <a id="380" href="ULC.Substitution.html#234" class="Bound">Atom</a>
<a id="385" class="Keyword">open</a> <a id="390" class="Keyword">import</a> <a id="397" href="Nominal.html" class="Module">Nominal</a>     <a id="409" href="ULC.Substitution.html#234" class="Bound">Atom</a>

<a id="415" class="Comment">-- specialized version of `mapAbs` for Term</a>
<a id="459" class="Comment">-- mapAbs-Term : (x&#39; : Abs Term) → (∀ (t : Term) → t ≺ᵐ x&#39; → Term) → Abs Term</a>
<a id="537" class="Comment">-- mapAbs-Term x&#39; f =</a>
<a id="559" class="Comment">--   let a , _ = fresh (supp x&#39; ++ supp?? f)</a>
<a id="604" class="Comment">--   in abs a (f (conc x&#39; a) (conc≺ x&#39; a))</a>

<a id="648" class="Comment">-- capture-avoiding application</a>
<a id="680" class="Comment">-- conc† : Abs Term → Atom → Term</a>
<a id="714" class="Comment">-- conc† f@(abs x t) y =</a>
<a id="739" class="Comment">--   let z , _ = fresh (y ∷ supp f)</a>
<a id="775" class="Comment">--   in conc (⦅ x ↔ z ⦆ f) y</a>

<a id="_[_/_]"></a><a id="805" href="ULC.Substitution.html#805" class="Function Operator">_[_/_]</a> <a id="812" class="Symbol">:</a> <a id="814" href="ULC.Base.html#325" class="Datatype">Term</a> <a id="819" class="Symbol">→</a> <a id="821" href="ULC.Substitution.html#234" class="Bound">Atom</a> <a id="826" class="Symbol">→</a> <a id="828" href="ULC.Base.html#325" class="Datatype">Term</a> <a id="833" class="Symbol">→</a> <a id="835" href="ULC.Base.html#325" class="Datatype">Term</a>
<a id="840" href="ULC.Substitution.html#840" class="Bound">t₀</a> <a id="843" href="ULC.Substitution.html#805" class="Function Operator">[</a> <a id="845" href="ULC.Substitution.html#845" class="Bound">𝕒</a> <a id="847" href="ULC.Substitution.html#805" class="Function Operator">/</a> <a id="849" href="ULC.Substitution.html#849" class="Bound">s</a> <a id="851" href="ULC.Substitution.html#805" class="Function Operator">]</a> <a id="853" class="Symbol">=</a> <a id="855" href="Prelude.Measurable.html#1510" class="Function">≺-rec</a> <a id="861" class="Symbol">_</a> <a id="863" href="ULC.Substitution.html#881" class="Function">go</a> <a id="866" href="ULC.Substitution.html#840" class="Bound">t₀</a>
  <a id="871" class="Keyword">where</a>
    <a id="881" href="ULC.Substitution.html#881" class="Function">go</a> <a id="884" class="Symbol">:</a> <a id="886" class="Symbol">∀</a> <a id="888" href="ULC.Substitution.html#888" class="Bound">x</a> <a id="890" class="Symbol">→</a> <a id="892" class="Symbol">(∀</a> <a id="895" href="ULC.Substitution.html#895" class="Bound">y</a> <a id="897" class="Symbol">→</a> <a id="899" href="ULC.Substitution.html#895" class="Bound">y</a> <a id="901" href="Prelude.Measurable.html#1405" class="Function Operator">≺</a> <a id="903" href="ULC.Substitution.html#888" class="Bound">x</a> <a id="905" class="Symbol">→</a> <a id="907" href="ULC.Base.html#325" class="Datatype">Term</a><a id="911" class="Symbol">)</a> <a id="913" class="Symbol">→</a> <a id="915" href="ULC.Base.html#325" class="Datatype">Term</a>
    <a id="924" href="ULC.Substitution.html#881" class="Function">go</a> <a id="927" href="ULC.Substitution.html#927" class="Bound">x</a> <a id="929" href="ULC.Substitution.html#929" class="Bound">rec</a> <a id="933" class="Keyword">with</a> <a id="938" href="ULC.Substitution.html#927" class="Bound">x</a>
    <a id="944" class="Symbol">...</a> <a id="948" class="Symbol">|</a> <a id="950" href="ULC.Base.html#345" class="InductiveConstructor Operator">`</a> <a id="952" href="ULC.Substitution.html#952" class="Bound">x</a>   <a id="956" class="Symbol">=</a> <a id="958" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="961" href="ULC.Substitution.html#952" class="Bound">x</a> <a id="963" href="Prelude.DecEq.Core.html#169" class="Function Operator">==</a> <a id="966" href="ULC.Substitution.html#845" class="Bound">𝕒</a> <a id="968" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="973" href="ULC.Substitution.html#849" class="Bound">s</a> <a id="975" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="980" href="ULC.Base.html#345" class="InductiveConstructor Operator">`</a> <a id="982" href="ULC.Substitution.html#952" class="Bound">x</a>
    <a id="988" class="Symbol">...</a> <a id="992" class="Symbol">|</a> <a id="994" href="ULC.Substitution.html#994" class="Bound">l</a> <a id="996" href="ULC.Base.html#365" class="InductiveConstructor Operator">·</a> <a id="998" href="ULC.Substitution.html#998" class="Bound">m</a> <a id="1000" class="Symbol">=</a> <a id="1002" class="Bound">rec</a> <a id="1006" href="ULC.Substitution.html#994" class="Bound">l</a> <a id="1008" class="Symbol">(</a><a id="1009" href="ULC.Substitution.html#994" class="Bound">l</a> <a id="1011" href="ULC.Measure.html#2174" class="Function Operator">·≺ˡ</a> <a id="1015" href="ULC.Substitution.html#998" class="Bound">m</a><a id="1016" class="Symbol">)</a> <a id="1018" href="ULC.Base.html#365" class="InductiveConstructor Operator">·</a> <a id="1020" class="Bound">rec</a> <a id="1024" href="ULC.Substitution.html#998" class="Bound">m</a> <a id="1026" class="Symbol">(</a><a id="1027" href="ULC.Substitution.html#994" class="Bound">l</a> <a id="1029" href="ULC.Measure.html#2319" class="Function Operator">·≺ʳ</a> <a id="1033" href="ULC.Substitution.html#998" class="Bound">m</a><a id="1034" class="Symbol">)</a>
    <a id="1040" class="Comment">-- Cannot simply use `ƛ (mapAbs go f)` here; need well-founded recursion</a>
    <a id="1117" class="Comment">-- ... | ƛ f   = ƛ mapAbs-Term f (λ t t≺ → rec t t≺)</a>
    <a id="1174" class="Symbol">...</a> <a id="1178" class="Symbol">|</a> <a id="1180" href="ULC.Base.html#382" class="InductiveConstructor Operator">ƛ</a> <a id="1182" href="ULC.Substitution.html#1182" class="Bound">f</a> <a id="1184" class="Symbol">=</a>
      <a id="1192" class="Keyword">let</a> <a id="1196" href="ULC.Substitution.html#1196" class="Bound">y</a> <a id="1198" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1200" class="Symbol">_</a> <a id="1202" class="Symbol">=</a> <a id="1204" href="Prelude.InfEnumerable.html#1634" class="Function">fresh</a> <a id="1210" class="Symbol">(</a><a id="1211" href="Prelude.DecLists.html#1445" class="Function">nub</a> <a id="1215" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1217" href="ULC.Substitution.html#845" class="Bound">𝕒</a> <a id="1219" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1221" href="Nominal.Support.html#980" class="Function">supp</a> <a id="1226" href="ULC.Substitution.html#1182" class="Bound">f</a> <a id="1228" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="1231" href="Nominal.Support.html#980" class="Function">supp</a> <a id="1236" href="ULC.Substitution.html#849" class="Bound">s</a><a id="1237" class="Symbol">)</a>
      <a id="1245" class="Keyword">in</a>  <a id="1249" href="ULC.Base.html#717" class="InductiveConstructor Operator">ƛ</a> <a id="1251" href="ULC.Substitution.html#1196" class="Bound">y</a> <a id="1253" href="ULC.Base.html#717" class="InductiveConstructor Operator">⇒</a> <a id="1255" class="Bound">rec</a> <a id="1259" class="Symbol">(</a><a id="1260" href="Nominal.Abs.Base.html#1274" class="Function">conc</a> <a id="1265" href="ULC.Substitution.html#1182" class="Bound">f</a> <a id="1267" href="ULC.Substitution.html#1196" class="Bound">y</a><a id="1268" class="Symbol">)</a> <a id="1270" class="Symbol">(</a><a id="1271" href="ULC.Measure.html#1772" class="Function">conc≺</a> <a id="1277" href="ULC.Substitution.html#1182" class="Bound">f</a> <a id="1279" href="ULC.Substitution.html#1196" class="Bound">y</a><a id="1280" class="Symbol">)</a>

<a id="1283" class="Comment">-- enforce the Barendregt convention: no shadowing, distinct bound variables</a>
<a id="1360" class="Comment">-- T0D0: fix</a>
<a id="barendregt"></a><a id="1373" href="ULC.Substitution.html#1373" class="Function">barendregt</a> <a id="1384" class="Symbol">:</a> <a id="1386" href="Algebra.Core.html#475" class="Function">Op₁</a> <a id="1390" href="ULC.Base.html#325" class="Datatype">Term</a>
<a id="1395" href="ULC.Substitution.html#1373" class="Function">barendregt</a> <a id="1406" class="Symbol">=</a> <a id="1408" class="Symbol">λ</a> <a id="1410" class="Keyword">where</a>
  <a id="1418" class="Symbol">(</a><a id="1419" href="ULC.Base.html#345" class="InductiveConstructor Operator">`</a> <a id="1421" href="ULC.Substitution.html#1421" class="Bound">x</a><a id="1422" class="Symbol">)</a>     <a id="1428" class="Symbol">→</a> <a id="1430" href="ULC.Base.html#345" class="InductiveConstructor Operator">`</a> <a id="1432" href="ULC.Substitution.html#1421" class="Bound">x</a>
  <a id="1436" class="Symbol">(</a><a id="1437" href="ULC.Substitution.html#1437" class="Bound">l</a> <a id="1439" href="ULC.Base.html#365" class="InductiveConstructor Operator">·</a> <a id="1441" href="ULC.Substitution.html#1441" class="Bound">r</a><a id="1442" class="Symbol">)</a>   <a id="1446" class="Symbol">→</a> <a id="1448" href="ULC.Substitution.html#1373" class="Function">barendregt</a> <a id="1459" href="ULC.Substitution.html#1437" class="Bound">l</a> <a id="1461" href="ULC.Base.html#365" class="InductiveConstructor Operator">·</a> <a id="1463" href="ULC.Substitution.html#1373" class="Function">barendregt</a> <a id="1474" href="ULC.Substitution.html#1441" class="Bound">r</a>
  <a id="1478" class="Symbol">(</a><a id="1479" href="ULC.Base.html#717" class="InductiveConstructor Operator">ƛ</a> <a id="1481" href="ULC.Substitution.html#1481" class="Bound">a</a> <a id="1483" href="ULC.Base.html#717" class="InductiveConstructor Operator">⇒</a> <a id="1485" href="ULC.Substitution.html#1485" class="Bound">t</a><a id="1486" class="Symbol">)</a> <a id="1488" class="Symbol">→</a> <a id="1490" href="ULC.Base.html#382" class="InductiveConstructor Operator">ƛ</a> <a id="1492" href="Nominal.Support.html#5179" class="Function">freshen</a> <a id="1500" class="Symbol">(</a><a id="1501" href="Nominal.Abs.Base.html#376" class="InductiveConstructor">abs</a> <a id="1505" href="ULC.Substitution.html#1481" class="Bound">a</a> <a id="1507" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1509" href="ULC.Substitution.html#1373" class="Function">barendregt</a> <a id="1520" href="ULC.Substitution.html#1485" class="Bound">t</a><a id="1521" class="Symbol">)</a>
</pre></body></html>